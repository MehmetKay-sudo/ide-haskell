"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const atom_1 = require("atom");
const utils_1 = require("../utils");
const tooltip_manager_1 = require("./tooltip-manager");
class EditorControl {
    constructor(editor, pluginManager) {
        this.editor = editor;
        this.trackMouseBufferPosition = (e) => {
            const bufferPt = utils_1.bufferPositionFromMouseEvent(this.editor, e);
            if (!bufferPt) {
                return;
            }
            if (this.lastMouseBufferPt && this.lastMouseBufferPt.isEqual(bufferPt)) {
                return;
            }
            this.lastMouseBufferPt = bufferPt;
            if (this.exprTypeTimeout !== undefined) {
                clearTimeout(this.exprTypeTimeout);
            }
            this.exprTypeTimeout = window.setTimeout(() => {
                this.shouldShowTooltip(bufferPt, "mouse");
            }, atom.config.get('ide-haskell.expressionTypeInterval', {
                scope: this.editor.getRootScopeDescriptor(),
            }));
        };
        this.stopTrackingMouseBufferPosition = () => {
            if (this.exprTypeTimeout !== undefined) {
                return clearTimeout(this.exprTypeTimeout);
            }
        };
        this.trackSelection = ({ newBufferRange }) => {
            this.handleCursorUnderTooltip(newBufferRange);
            if (this.selTimeout !== undefined) {
                clearTimeout(this.selTimeout);
            }
            if (newBufferRange.isEmpty()) {
                this.tooltips.hide("selection");
                if (this.exprTypeTimeout !== undefined) {
                    clearTimeout(this.exprTypeTimeout);
                }
                this.tooltipRegistry.showTooltip(this.editor, "keyboard");
                if (atom.config.get('ide-haskell.onCursorMove', {
                    scope: this.editor.getRootScopeDescriptor(),
                }) === 'Hide Tooltip') {
                    this.tooltips.hide("mouse", undefined, {
                        persistent: false,
                    });
                    this.tooltips.hide("context", undefined, {
                        persistent: false,
                    });
                }
            }
            else {
                this.selTimeout = window.setTimeout(() => this.shouldShowTooltip(newBufferRange.start, "selection"), atom.config.get('ide-haskell.expressionTypeInterval', {
                    scope: this.editor.getRootScopeDescriptor(),
                }));
            }
        };
        this.disposables = new atom_1.CompositeDisposable();
        this.tooltips = new tooltip_manager_1.TooltipManager(this.editor);
        this.disposables.add(this.tooltips);
        this.tooltipRegistry = pluginManager.tooltipRegistry;
        this.editorElement = atom.views.getView(this.editor);
        const buffer = this.editor.getBuffer();
        this.disposables.add(buffer.onWillSave(() => pluginManager.willSaveBuffer(buffer)), buffer.onDidSave(() => pluginManager.didSaveBuffer(buffer)), this.editor.onDidStopChanging(() => pluginManager.didStopChanging(buffer)), this.editorElement.onDidChangeScrollLeft(() => this.tooltips.hide("mouse")), this.editorElement.onDidChangeScrollTop(() => this.tooltips.hide("mouse")), utils_1.listen(this.editorElement, 'mousemove', '.scroll-view', this.trackMouseBufferPosition), utils_1.listen(this.editorElement, 'mouseout', '.scroll-view', this.stopTrackingMouseBufferPosition), this.editor.onDidChangeSelectionRange(this.trackSelection));
    }
    static supportsGrammar(grammar) {
        return [
            'source.haskell',
            'text.tex.latex.haskell',
        ].includes(grammar);
    }
    destroy() {
        if (this.exprTypeTimeout !== undefined) {
            clearTimeout(this.exprTypeTimeout);
        }
        if (this.selTimeout !== undefined) {
            clearTimeout(this.selTimeout);
        }
        this.disposables.dispose();
        this.lastMouseBufferPt = undefined;
    }
    getEventRange(eventType) {
        let crange;
        let pos;
        switch (eventType) {
            case 'mouse':
            case 'context':
                if (!this.lastMouseBufferPt)
                    return undefined;
                pos = this.lastMouseBufferPt;
                const selRanges = this.editor
                    .getSelections()
                    .map((sel) => sel.getBufferRange())
                    .filter((sel) => sel.containsPoint(pos));
                crange = selRanges.length > 0 ? selRanges[0] : new atom_1.Range(pos, pos);
                break;
            case 'keyboard':
            case 'selection':
                crange = this.editor.getLastSelection().getBufferRange();
                pos = crange.start;
                break;
            default:
                throw new TypeError('Switch assertion failed');
        }
        return { crange, pos, eventType };
    }
    shouldShowTooltip(pos, type) {
        if (pos.row < 0 ||
            pos.row >= this.editor.getLineCount() ||
            pos.isEqual(this.editor.getBuffer().rangeForRow(pos.row, false).end)) {
            this.tooltips.hide(type);
        }
        else {
            this.tooltipRegistry.showTooltip(this.editor, type);
        }
    }
    handleCursorUnderTooltip(currentRange) {
        const tooltipElement = document.querySelector('ide-haskell-tooltip');
        if (!tooltipElement) {
            return;
        }
        const slcl = this.editorElement.pixelRectForScreenRange(this.editor.screenRangeForBufferRange(currentRange));
        const sv = this.editorElement.querySelector('.scroll-view');
        if (!sv) {
            return;
        }
        const eecl = sv.getBoundingClientRect();
        const ttcl = tooltipElement.getBoundingClientRect();
        const div = tooltipElement.querySelector('div');
        if (!div) {
            return;
        }
        const ttcld = div.getBoundingClientRect();
        const ttbox = {
            left: ttcl.left - eecl.left,
            top: ttcld.top - eecl.top,
            width: ttcl.width,
            height: ttcld.height,
        };
        const xmax = Math.round(Math.max(ttbox.left, slcl.left));
        const xmin = Math.round(Math.min(ttbox.left + ttbox.width, slcl.left + slcl.width));
        const ymax = Math.round(Math.max(ttbox.top, slcl.top));
        const ymin = Math.round(Math.min(ttbox.top + ttbox.height, slcl.top + slcl.height));
        const tt = document.querySelector('ide-haskell-tooltip');
        if (tt) {
            if (ymax <= ymin && xmax <= xmin) {
                tt.classList.add('ide-haskell-tooltip-subdued');
            }
            else {
                tt.classList.remove('ide-haskell-tooltip-subdued');
            }
        }
    }
}
exports.EditorControl = EditorControl;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZWRpdG9yLWNvbnRyb2wvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSwrQkFBZ0Y7QUFDaEYsb0NBQStEO0FBQy9ELHVEQUFrRDtBQVVsRCxNQUFhLGFBQWE7SUFtQnhCLFlBQW9CLE1BQWtCLEVBQUUsYUFBNEI7UUFBaEQsV0FBTSxHQUFOLE1BQU0sQ0FBWTtRQXFHOUIsNkJBQXdCLEdBQUcsQ0FBQyxDQUFhLEVBQUUsRUFBRTtZQUNuRCxNQUFNLFFBQVEsR0FBRyxvQ0FBNEIsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFBO1lBQzdELElBQUksQ0FBQyxRQUFRLEVBQUU7Z0JBQ2IsT0FBTTthQUNQO1lBRUQsSUFBSSxJQUFJLENBQUMsaUJBQWlCLElBQUksSUFBSSxDQUFDLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRTtnQkFDdEUsT0FBTTthQUNQO1lBQ0QsSUFBSSxDQUFDLGlCQUFpQixHQUFHLFFBQVEsQ0FBQTtZQUVqQyxJQUFJLElBQUksQ0FBQyxlQUFlLEtBQUssU0FBUyxFQUFFO2dCQUN0QyxZQUFZLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFBO2FBQ25DO1lBQ0QsSUFBSSxDQUFDLGVBQWUsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUN0QyxHQUFHLEVBQUU7Z0JBQ0gsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsVUFBd0IsQ0FBQTtZQUN6RCxDQUFDLEVBQ0QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsb0NBQW9DLEVBQUU7Z0JBQ3BELEtBQUssRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLHNCQUFzQixFQUFFO2FBQzVDLENBQUMsQ0FDSCxDQUFBO1FBQ0gsQ0FBQyxDQUFBO1FBRU8sb0NBQStCLEdBQUcsR0FBRyxFQUFFO1lBQzdDLElBQUksSUFBSSxDQUFDLGVBQWUsS0FB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SSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUE7UUFDeEQsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FDckIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQzNELENBQUE7UUFDRCxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTtRQUN0RCxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUNyQixJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLEdBQUcsS0FBSyxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FDM0QsQ0FBQTtRQUNELE1BQU0sRUFBRSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQy9CLHFCQUFxQixDQUNBLENBQUE7UUFDdkIsSUFBSSxFQUFFLEVBQUU7WUFDTixJQUFJLElBQUksSUFBSSxJQUFJLElBQUksSUFBSSxJQUFJLElBQUksRUFBRTtnQkFDaEMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsNkJBQTZCLENBQUMsQ0FBQTthQUNoRDtpQkFBTTtnQkFDTCxFQUFFLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyw2QkFBNkIsQ0FBQyxDQUFBO2FBQ25EO1NBQ0Y7SUFDSCxDQUFDO0NBQ0Y7QUF6T0Qsc0NBeU9DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmFuZ2UsIFRleHRFZGl0b3IsIFBvaW50LCBDb21wb3NpdGVEaXNwb3NhYmxlLCBEaXNwb3NhYmxlIH0gZnJvbSAnYXRvbSdcbmltcG9ydCB7IGJ1ZmZlclBvc2l0aW9uRnJvbU1vdXNlRXZlbnQsIGxpc3RlbiB9IGZyb20gJy4uL3V0aWxzJ1xuaW1wb3J0IHsgVG9vbHRpcE1hbmFnZXIgfSBmcm9tICcuL3Rvb2x0aXAtbWFuYWdlcidcbmltcG9ydCB7IFRvb2x0aXBSZWdpc3RyeSB9IGZyb20gJy4uL3Rvb2x0aXAtcmVnaXN0cnknXG5pbXBvcnQgeyBQbHVnaW5NYW5hZ2VyLCBJRWRpdG9yQ29udHJvbGxlciB9IGZyb20gJy4uL3BsdWdpbi1tYW5hZ2VyJ1xuaW1wb3J0ICogYXMgVVBJIGZyb20gJ2F0b20taGFza2VsbC11cGknXG5pbXBvcnQgVEV2ZW50UmFuZ2VUeXBlID0gVVBJLlRFdmVudFJhbmdlVHlwZVxuXG5leHBvcnQgdHlwZSBURXZlbnRSYW5nZVJlc3VsdCA9XG4gIHwgeyBjcmFuZ2U6IFJhbmdlOyBwb3M6IFBvaW50OyBldmVudFR5cGU6IFRFdmVudFJhbmdlVHlwZSB9XG4gIHwgdW5kZWZpbmVkXG5cbmV4cG9ydCBjbGFzcyBFZGl0b3JDb250cm9sIGltcGxlbWVudHMgSUVkaXRvckNvbnRyb2xsZXIge1xuICBwdWJsaWMgdG9vbHRpcHM6IFRvb2x0aXBNYW5hZ2VyXG4gIHByaXZhdGUgZGlzcG9zYWJsZXM6IENvbXBvc2l0ZURpc3Bvc2FibGVcbiAgcHJpdmF0ZSBsYXN0TW91c2VCdWZmZXJQdD86IFBvaW50XG4gIHByaXZhdGUgZXhwclR5cGVUaW1lb3V0PzogbnVtYmVyXG4gIHByaXZhdGUgc2VsVGltZW91dD86IG51bWJlclxuICBwcml2YXRlIGVkaXRvckVsZW1lbnQ6IEhUTUxFbGVtZW50ICYge1xuICAgIG9uRGlkQ2hhbmdlU2Nyb2xsVG9wKGE6ICgpID0+IHZvaWQpOiBEaXNwb3NhYmxlXG4gICAgb25EaWRDaGFuZ2VTY3JvbGxMZWZ0KGE6ICgpID0+IHZvaWQpOiBEaXNwb3NhYmxlXG4gICAgcGl4ZWxSZWN0Rm9yU2NyZWVuUmFuZ2UoXG4gICAgICByOiBSYW5nZSxcbiAgICApOiB7XG4gICAgICBsZWZ0OiBudW1iZXJcbiAgICAgIHRvcDogbnVtYmVyXG4gICAgICB3aWR0aDogbnVtYmVyXG4gICAgICBoZWlnaHQ6IG51bWJlclxuICAgIH1cbiAgfVxuICBwcml2YXRlIHRvb2x0aXBSZWdpc3RyeTogVG9vbHRpcFJlZ2lzdHJ5XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZWRpdG9yOiBUZXh0RWRpdG9yLCBwbHVnaW5NYW5hZ2VyOiBQbHVnaW5NYW5hZ2VyKSB7XG4gICAgdGhpcy5kaXNwb3NhYmxlcyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKClcbiAgICB0aGlzLnRvb2x0aXBzID0gbmV3IFRvb2x0aXBNYW5hZ2VyKHRoaXMuZWRpdG9yKVxuICAgIHRoaXMuZGlzcG9zYWJsZXMuYWRkKHRoaXMudG9vbHRpcHMpXG4gICAgdGhpcy50b29sdGlwUmVnaXN0cnkgPSBwbHVnaW5NYW5hZ2VyLnRvb2x0aXBSZWdpc3RyeVxuXG4gICAgdGhpcy5lZGl0b3JFbGVtZW50ID0gYXRvbS52aWV3cy5nZXRWaWV3KHRoaXMuZWRpdG9yKSBhcyBhbnlcblxuICAgIGNvbnN0IGJ1ZmZlciA9IHRoaXMuZWRpdG9yLmdldEJ1ZmZlcigpXG5cbiAgICB0aGlzLmRpc3Bvc2FibGVzLmFkZChcbiAgICAgIC8vIGJ1ZmZlciBldmVudHMgZm9yIGF1dG9tYXRpYyBjaGVja1xuICAgICAgYnVmZmVyLm9uV2lsbFNhdmUoKCkgPT4gcGx1Z2luTWFuYWdlci53aWxsU2F2ZUJ1ZmZlcihidWZmZXIpKSxcbiAgICAgIGJ1ZmZlci5vbkRpZFNhdmUoKCkgPT4gcGx1Z2luTWFuYWdlci5kaWRTYXZlQnVmZmVyKGJ1ZmZlcikpLFxuICAgICAgdGhpcy5lZGl0b3Iub25EaWRTdG9wQ2hhbmdpbmcoKCkgPT5cbiAgICAgICAgcGx1Z2luTWFuYWdlci5kaWRTdG9wQ2hhbmdpbmcoYnVmZmVyKSxcbiAgICAgICksXG4gICAgICAvLyB0b29sdGlwIHRyYWNraW5nIChtb3VzZSBhbmQgc2VsZWN0aW9uKVxuICAgICAgdGhpcy5lZGl0b3JFbGVtZW50Lm9uRGlkQ2hhbmdlU2Nyb2xsTGVmdCgoKSA9PlxuICAgICAgICB0aGlzLnRvb2x0aXBzLmhpZGUoVEV2ZW50UmFuZ2VUeXBlLm1vdXNlKSxcbiAgICAgICksXG4gICAgICB0aGlzLmVkaXRvckVsZW1lbnQub25EaWRDaGFuZ2VTY3JvbGxUb3AoKCkgPT5cbiAgICAgICAgdGhpcy50b29sdGlwcy5oaWRlKFRFdmVudFJhbmdlVHlwZS5tb3VzZSksXG4gICAgICApLFxuICAgICAgbGlzdGVuKFxuICAgICAgICB0aGlzLmVkaXRvckVsZW1lbnQsXG4gICAgICAgICdtb3VzZW1vdmUnLFxuICAgICAgICAnLnNjcm9sbC12aWV3JyxcbiAgICAgICAgdGhpcy50cmFja01vdXNlQnVmZmVyUG9zaXRpb24sXG4gICAgICApLFxuICAgICAgbGlzdGVuKFxuICAgICAgICB0aGlzLmVkaXRvckVsZW1lbnQsXG4gICAgICAgICdtb3VzZW91dCcsXG4gICAgICAgICcuc2Nyb2xsLXZpZXcnLFxuICAgICAgICB0aGlzLnN0b3BUcmFja2luZ01vdXNlQnVmZmVyUG9zaXRpb24sXG4gICAgICApLFxuICAgICAgdGhpcy5lZGl0b3Iub25EaWRDaGFuZ2VTZWxlY3Rpb25SYW5nZSh0aGlzLnRyYWNrU2VsZWN0aW9uKSxcbiAgICApXG4gIH1cblxuICBwdWJsaWMgc3RhdGljIHN1cHBvcnRzR3JhbW1hcihncmFtbWFyOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gW1xuICAgICAgLy8gJ3NvdXJjZS5jMmhzJyxcbiAgICAgIC8vICdzb3VyY2UuY2FiYWwnLFxuICAgICAgLy8gJ3NvdXJjZS5oc2MyaHMnLFxuICAgICAgJ3NvdXJjZS5oYXNrZWxsJyxcbiAgICAgICd0ZXh0LnRleC5sYXRleC5oYXNrZWxsJyxcbiAgICAgIC8vICdzb3VyY2UuaHNpZycsXG4gICAgXS5pbmNsdWRlcyhncmFtbWFyKVxuICB9XG5cbiAgcHVibGljIGRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMuZXhwclR5cGVUaW1lb3V0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aGlzLmV4cHJUeXBlVGltZW91dClcbiAgICB9XG4gICAgaWYgKHRoaXMuc2VsVGltZW91dCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5zZWxUaW1lb3V0KVxuICAgIH1cbiAgICB0aGlzLmRpc3Bvc2FibGVzLmRpc3Bvc2UoKVxuICAgIHRoaXMubGFzdE1vdXNlQnVmZmVyUHQgPSB1bmRlZmluZWRcbiAgfVxuXG4gIHB1YmxpYyBnZXRFdmVudFJhbmdlKGV2ZW50VHlwZTogVEV2ZW50UmFuZ2VUeXBlKTogVEV2ZW50UmFuZ2VSZXN1bHQge1xuICAgIGxldCBjcmFuZ2U6IFJhbmdlXG4gICAgbGV0IHBvczogUG9pbnRcbiAgICBzd2l0Y2ggKGV2ZW50VHlwZSkge1xuICAgICAgY2FzZSAnbW91c2UnOlxuICAgICAgY2FzZSAnY29udGV4dCc6XG4gICAgICAgIGlmICghdGhpcy5sYXN0TW91c2VCdWZmZXJQdCkgcmV0dXJuIHVuZGVmaW5lZFxuICAgICAgICBwb3MgPSB0aGlzLmxhc3RNb3VzZUJ1ZmZlclB0XG4gICAgICAgIGNvbnN0IHNlbFJhbmdlcyA9IHRoaXMuZWRpdG9yXG4gICAgICAgICAgLmdldFNlbGVjdGlvbnMoKVxuICAgICAgICAgIC5tYXAoKHNlbCkgPT4gc2VsLmdldEJ1ZmZlclJhbmdlKCkpXG4gICAgICAgICAgLmZpbHRlcigoc2VsKSA9PiBzZWwuY29udGFpbnNQb2ludChwb3MpKVxuICAgICAgICBjcmFuZ2UgPSBzZWxSYW5nZXMubGVuZ3RoID4gMCA/IHNlbFJhbmdlc1swXSA6IG5ldyBSYW5nZShwb3MsIHBvcylcbiAgICAgICAgYnJlYWtcbiAgICAgIGNhc2UgJ2tleWJvYXJkJzpcbiAgICAgIGNhc2UgJ3NlbGVjdGlvbic6XG4gICAgICAgIGNyYW5nZSA9IHRoaXMuZWRpdG9yLmdldExhc3RTZWxlY3Rpb24oKS5nZXRCdWZmZXJSYW5nZSgpXG4gICAgICAgIHBvcyA9IGNyYW5nZS5zdGFydFxuICAgICAgICBicmVha1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignU3dpdGNoIGFzc2VydGlvbiBmYWlsZWQnKVxuICAgIH1cblxuICAgIHJldHVybiB7IGNyYW5nZSwgcG9zLCBldmVudFR5cGUgfVxuICB9XG5cbiAgcHJpdmF0ZSBzaG91bGRTaG93VG9vbHRpcChwb3M6IFBvaW50LCB0eXBlOiBURXZlbnRSYW5nZVR5cGUpIHtcbiAgICBpZiAoXG4gICAgICBwb3Mucm93IDwgMCB8fFxuICAgICAgcG9zLnJvdyA+PSB0aGlzLmVkaXRvci5nZXRMaW5lQ291bnQoKSB8fFxuICAgICAgcG9zLmlzRXF1YWwodGhpcy5lZGl0b3IuZ2V0QnVmZmVyKCkucmFuZ2VGb3JSb3cocG9zLnJvdywgZmFsc2UpLmVuZClcbiAgICApIHtcbiAgICAgIHRoaXMudG9vbHRpcHMuaGlkZSh0eXBlKVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tZmxvYXRpbmctcHJvbWlzZXNcbiAgICAgIHRoaXMudG9vbHRpcFJlZ2lzdHJ5LnNob3dUb29sdGlwKHRoaXMuZWRpdG9yLCB0eXBlKVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgdHJhY2tNb3VzZUJ1ZmZlclBvc2l0aW9uID0gKGU6IE1vdXNlRXZlbnQpID0+IHtcbiAgICBjb25zdCBidWZmZXJQdCA9IGJ1ZmZlclBvc2l0aW9uRnJvbU1vdXNlRXZlbnQodGhpcy5lZGl0b3IsIGUpXG4gICAgaWYgKCFidWZmZXJQdCkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgaWYgKHRoaXMubGFzdE1vdXNlQnVmZmVyUHQgJiYgdGhpcy5sYXN0TW91c2VCdWZmZXJQdC5pc0VxdWFsKGJ1ZmZlclB0KSkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuICAgIHRoaXMubGFzdE1vdXNlQnVmZmVyUHQgPSBidWZmZXJQdFxuXG4gICAgaWYgKHRoaXMuZXhwclR5cGVUaW1lb3V0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aGlzLmV4cHJUeXBlVGltZW91dClcbiAgICB9XG4gICAgdGhpcy5leHByVHlwZVRpbWVvdXQgPSB3aW5kb3cuc2V0VGltZW91dChcbiAgICAgICgpID0+IHtcbiAgICAgICAgdGhpcy5zaG91bGRTaG93VG9vbHRpcChidWZmZXJQdCwgVEV2ZW50UmFuZ2VUeXBlLm1vdXNlKVxuICAgICAgfSxcbiAgICAgIGF0b20uY29uZmlnLmdldCgnaWRlLWhhc2tlbGwuZXhwcmVzc2lvblR5cGVJbnRlcnZhbCcsIHtcbiAgICAgICAgc2NvcGU6IHRoaXMuZWRpdG9yLmdldFJvb3RTY29wZURlc2NyaXB0b3IoKSxcbiAgICAgIH0pLFxuICAgIClcbiAgfVxuXG4gIHByaXZhdGUgc3RvcFRyYWNraW5nTW91c2VCdWZmZXJQb3NpdGlvbiA9ICgpID0+IHtcbiAgICBpZiAodGhpcy5leHByVHlwZVRpbWVvdXQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIGNsZWFyVGltZW91dCh0aGlzLmV4cHJUeXBlVGltZW91dClcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHRyYWNrU2VsZWN0aW9uID0gKHsgbmV3QnVmZmVyUmFuZ2UgfTogeyBuZXdCdWZmZXJSYW5nZTogUmFuZ2UgfSkgPT4ge1xuICAgIHRoaXMuaGFuZGxlQ3Vyc29yVW5kZXJUb29sdGlwKG5ld0J1ZmZlclJhbmdlKVxuXG4gICAgaWYgKHRoaXMuc2VsVGltZW91dCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5zZWxUaW1lb3V0KVxuICAgIH1cbiAgICBpZiAobmV3QnVmZmVyUmFuZ2UuaXNFbXB0eSgpKSB7XG4gICAgICB0aGlzLnRvb2x0aXBzLmhpZGUoVEV2ZW50UmFuZ2VUeXBlLnNlbGVjdGlvbilcbiAgICAgIGlmICh0aGlzLmV4cHJUeXBlVGltZW91dCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmV4cHJUeXBlVGltZW91dClcbiAgICAgIH1cbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1mbG9hdGluZy1wcm9taXNlc1xuICAgICAgdGhpcy50b29sdGlwUmVnaXN0cnkuc2hvd1Rvb2x0aXAodGhpcy5lZGl0b3IsIFRFdmVudFJhbmdlVHlwZS5rZXlib2FyZClcbiAgICAgIGlmIChcbiAgICAgICAgYXRvbS5jb25maWcuZ2V0KCdpZGUtaGFza2VsbC5vbkN1cnNvck1vdmUnLCB7XG4gICAgICAgICAgc2NvcGU6IHRoaXMuZWRpdG9yLmdldFJvb3RTY29wZURlc2NyaXB0b3IoKSxcbiAgICAgICAgfSkgPT09ICdIaWRlIFRvb2x0aXAnXG4gICAgICApIHtcbiAgICAgICAgdGhpcy50b29sdGlwcy5oaWRlKFRFdmVudFJhbmdlVHlwZS5tb3VzZSwgdW5kZWZpbmVkLCB7XG4gICAgICAgICAgcGVyc2lzdGVudDogZmFsc2UsXG4gICAgICAgIH0pXG4gICAgICAgIHRoaXMudG9vbHRpcHMuaGlkZShURXZlbnRSYW5nZVR5cGUuY29udGV4dCwgdW5kZWZpbmVkLCB7XG4gICAgICAgICAgcGVyc2lzdGVudDogZmFsc2UsXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2VsVGltZW91dCA9IHdpbmRvdy5zZXRUaW1lb3V0KFxuICAgICAgICAoKSA9PlxuICAgICAgICAgIHRoaXMuc2hvdWxkU2hvd1Rvb2x0aXAoXG4gICAgICAgICAgICBuZXdCdWZmZXJSYW5nZS5zdGFydCxcbiAgICAgICAgICAgIFRFdmVudFJhbmdlVHlwZS5zZWxlY3Rpb24sXG4gICAgICAgICAgKSxcbiAgICAgICAgYXRvbS5jb25maWcuZ2V0KCdpZGUtaGFza2VsbC5leHByZXNzaW9uVHlwZUludGVydmFsJywge1xuICAgICAgICAgIHNjb3BlOiB0aGlzLmVkaXRvci5nZXRSb290U2NvcGVEZXNjcmlwdG9yKCksXG4gICAgICAgIH0pLFxuICAgICAgKVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlQ3Vyc29yVW5kZXJUb29sdGlwKGN1cnJlbnRSYW5nZTogUmFuZ2UpIHtcbiAgICBjb25zdCB0b29sdGlwRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lkZS1oYXNrZWxsLXRvb2x0aXAnKVxuICAgIGlmICghdG9vbHRpcEVsZW1lbnQpIHtcbiAgICAgIHJldHVyblxuICAgIH1cbiAgICBjb25zdCBzbGNsID0gdGhpcy5lZGl0b3JFbGVtZW50LnBpeGVsUmVjdEZvclNjcmVlblJhbmdlKFxuICAgICAgdGhpcy5lZGl0b3Iuc2NyZWVuUmFuZ2VGb3JCdWZmZXJSYW5nZShjdXJyZW50UmFuZ2UpLFxuICAgIClcbiAgICBjb25zdCBzdiA9IHRoaXMuZWRpdG9yRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2Nyb2xsLXZpZXcnKVxuICAgIGlmICghc3YpIHtcbiAgICAgIHJldHVyblxuICAgIH1cbiAgICBjb25zdCBlZWNsID0gc3YuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcbiAgICBjb25zdCB0dGNsID0gdG9vbHRpcEVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcbiAgICBjb25zdCBkaXYgPSB0b29sdGlwRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdkaXYnKVxuICAgIGlmICghZGl2KSB7XG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgY29uc3QgdHRjbGQgPSBkaXYuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcbiAgICBjb25zdCB0dGJveCA9IHtcbiAgICAgIGxlZnQ6IHR0Y2wubGVmdCAtIGVlY2wubGVmdCxcbiAgICAgIHRvcDogdHRjbGQudG9wIC0gZWVjbC50b3AsXG4gICAgICB3aWR0aDogdHRjbC53aWR0aCxcbiAgICAgIGhlaWdodDogdHRjbGQuaGVpZ2h0LFxuICAgIH1cbiAgICBjb25zdCB4bWF4ID0gTWF0aC5yb3VuZChNYXRoLm1heCh0dGJveC5sZWZ0LCBzbGNsLmxlZnQpKVxuICAgIGNvbnN0IHhtaW4gPSBNYXRoLnJvdW5kKFxuICAgICAgTWF0aC5taW4odHRib3gubGVmdCArIHR0Ym94LndpZHRoLCBzbGNsLmxlZnQgKyBzbGNsLndpZHRoKSxcbiAgICApXG4gICAgY29uc3QgeW1heCA9IE1hdGgucm91bmQoTWF0aC5tYXgodHRib3gudG9wLCBzbGNsLnRvcCkpXG4gICAgY29uc3QgeW1pbiA9IE1hdGgucm91bmQoXG4gICAgICBNYXRoLm1pbih0dGJveC50b3AgKyB0dGJveC5oZWlnaHQsIHNsY2wudG9wICsgc2xjbC5oZWlnaHQpLFxuICAgIClcbiAgICBjb25zdCB0dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAnaWRlLWhhc2tlbGwtdG9vbHRpcCcsXG4gICAgKSBhcyBIVE1MRWxlbWVudCB8IG51bGxcbiAgICBpZiAodHQpIHtcbiAgICAgIGlmICh5bWF4IDw9IHltaW4gJiYgeG1heCA8PSB4bWluKSB7XG4gICAgICAgIHR0LmNsYXNzTGlzdC5hZGQoJ2lkZS1oYXNrZWxsLXRvb2x0aXAtc3ViZHVlZCcpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0dC5jbGFzc0xpc3QucmVtb3ZlKCdpZGUtaGFza2VsbC10b29sdGlwLXN1YmR1ZWQnKVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIl19